<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solid, Liquid, Gas Animation</title>
    <style>
        body {
            font-family: sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: auto;
            max-width: 1920px;
        }
        #container {
            width: 90vw;
            height: 90vw;
            max-width: 600px;
            max-height: 600px;
            border: 4px solid #333;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0,0,0,0.2);
            background: linear-gradient(to bottom, #f0f0f0, #e0e0e0);
        }
        .particle {
            position: absolute;
            width: 14px;
            height: 14px;
            background-color: blue;
            border-radius: 50%;
        }
        #controls {
            margin-top: 20px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 8px;
            border: 1px solid #ccc;
            color: white;
            margin: 5px;
        }
        #solid-btn {
            background-color: brown;
        }
        #solid-btn:hover {
            background-color: #a52a2a; /* Darker brown */
        }
        #liquid-btn {
            background-color: blue;
        }
        #liquid-btn:hover {
            background-color: #0000cc; /* Darker blue */
        }
        #gas-btn {
            background-color: green;
        }
        #gas-btn:hover {
            background-color: #006400; /* Darker green */
        }
        .thread {
            position: absolute;
            height: 1px;
            background-color: brown;
            transform-origin: 0 0;
        }
        #water {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 50%;
            background-color: rgba(0, 0, 255, 0.3);
        }
    </style>
</head>
<body>
    <h1 style="text-align: center; margin-bottom: 20px;">STATE OF MATTER</h1>
    <div id="container">
        <div id="water"></div>
    </div>
    <div id="controls">
        <button id="solid-btn">Solid</button>
        <button id="liquid-btn">Liquid</button>
        <button id="gas-btn">Gas</button>
        <input type="range" min="0.1" max="5" value="1" step="0.1" id="speed-slider">
    </div>

    <script>
        const container = document.getElementById('container');
        const water = document.getElementById('water');
        const solidBtn = document.getElementById('solid-btn');
        const liquidBtn = document.getElementById('liquid-btn');
        const gasBtn = document.getElementById('gas-btn');
        const speedSlider = document.getElementById('speed-slider');

        let speed = 1;
        const numParticles = 116;
        const particleSize = 14;
        const particles = [];
        const threads = [];

        let currentState = 'solid';
        let animationFrameId;

        speedSlider.addEventListener('input', (e) => {
            speed = parseFloat(e.target.value);
        });

        window.addEventListener('resize', () => {
            arrangeParticles();
            if (currentState === 'solid') {
                drawThreads();
            }
        });

        function createParticles() {
            for (let i = 0; i < numParticles; i++) {
                const particle = document.createElement('div');
                particle.classList.add('particle');
                container.appendChild(particle);
                particles.push({
                    element: particle,
                    x: 0,
                    y: 0,
                    vx: 0,
                    vy: 0,
                    baseX: 0,
                    baseY: 0,
                    color: 'blue'
                });
            }
        }

        function arrangeParticles() {
            const containerWidth = container.offsetWidth;
            const containerHeight = container.offsetHeight;
            const padding = 20;
            const spacing = 5;
            const cols = Math.floor((containerWidth - padding * 2) / (particleSize + spacing));
            const rows = Math.ceil(numParticles / cols);

            const totalWidthOfParticles = cols * (particleSize + spacing);
            const startX = (containerWidth - totalWidthOfParticles) / 2;

            particles.forEach((p, i) => {
                const row = Math.floor(i / cols);
                const col = i % cols;
                p.baseX = startX + col * (particleSize + spacing);
                p.baseY = containerHeight - (padding + row * (particleSize + spacing));
                p.x = p.baseX;
                p.y = p.baseY;
                p.element.style.left = `${p.x}px`;
                p.element.style.top = `${p.y}px`;
            });
        }

        function drawThreads() {
            removeThreads();
            const cols = Math.floor((container.offsetWidth - 40) / (particleSize + 5));
            for (let i = 0; i < particles.length; i++) {
                const p1 = particles[i];

                if ((i + 1) % cols !== 0 && i + 1 < particles.length) {
                    const p2 = particles[i + 1];
                    createThread(p1, p2);
                }

                if (i + cols < particles.length) {
                    const p2 = particles[i + cols];
                    createThread(p1, p2);
                }
            }
        }

        function createThread(p1, p2) {
            const thread = document.createElement('div');
            thread.classList.add('thread');
            const dx = p2.x - p1.x;
            const dy = p2.y - p1.y;
            const length = Math.sqrt(dx * dx + dy * dy);
            const angle = Math.atan2(dy, dx) * 180 / Math.PI;

            thread.style.width = `${length}px`;
            thread.style.left = `${p1.x + particleSize / 2}px`;
            thread.style.top = `${p1.y + particleSize / 2}px`;
            thread.style.transform = `rotate(${angle}deg)`;
            container.appendChild(thread);
            threads.push(thread);
        }

        function removeThreads() {
            threads.forEach(thread => thread.remove());
            threads.length = 0;
        }


        function animate() {
            particles.forEach(p => {
                if (currentState === 'solid') {
                    p.vx = (Math.random() - 0.5) * 1 * speed;
                    p.vy = (Math.random() - 0.5) * 1 * speed;
                    p.element.style.transform = `translate(${p.vx}px, ${p.vy}px)`;
                } else {
                    if (currentState === 'gas') {
                        if (!p.baseVx) {
                            p.baseVx = (Math.random() - 0.5) * 4.0;
                            p.baseVy = (Math.random() - 0.5) * 4.0;
                        }
                        p.vx = p.baseVx * speed;
                        p.vy = p.baseVy * speed;
                    } else if (currentState === 'liquid') {
                        p.vx += (Math.random() - 0.5) * 0.5 * speed;
                        p.vy += (Math.random() - 0.5) * 0.5 * speed;
                        p.vx *= 0.95;
                        p.vy *= 0.95;
                    }

                    p.x += p.vx;
                    p.y += p.vy;

                    if (currentState === 'liquid') {
                        if (p.x < 0 || p.x > container.offsetWidth - particleSize) {
                            p.vx *= -1;
                            p.x = Math.max(0, Math.min(p.x, container.offsetWidth - particleSize));
                        }
                        if (p.y < container.offsetHeight / 2 || p.y > container.offsetHeight - particleSize) {
                            p.vy *= -1;
                            p.y = Math.max(container.offsetHeight / 2, Math.min(p.y, container.offsetHeight - particleSize));
                        }
                    } else { // Gas
                        if (p.x < 0 || p.x > container.offsetWidth - particleSize) {
                            p.baseVx *= -1;
                            p.x = Math.max(0, Math.min(p.x, container.offsetWidth - particleSize));
                        }
                        if (p.y < 0 || p.y > container.offsetHeight - particleSize) {
                            p.baseVy *= -1;
                            p.y = Math.max(0, Math.min(p.y, container.offsetHeight - particleSize));
                        }
                    }
                    p.element.style.left = `${p.x}px`;
                    p.element.style.top = `${p.y}px`;
                }
            });

            animationFrameId = requestAnimationFrame(animate);
        }

        function stopAnimation() {
            cancelAnimationFrame(animationFrameId);
        }

        solidBtn.addEventListener('click', () => {
            currentState = 'solid';
            water.style.display = 'none';
            stopAnimation();
            arrangeParticles();
            drawThreads();
            particles.forEach(p => p.element.style.backgroundColor = 'brown');
            animate();
        });

        liquidBtn.addEventListener('click', () => {
            currentState = 'liquid';
            water.style.display = 'block';
            removeThreads();
            particles.forEach(p => {
                p.element.style.transform = 'none';
                p.element.style.backgroundColor = 'blue';
            });
            if (!animationFrameId) {
                animate();
            }
        });

        gasBtn.addEventListener('click', () => {
            currentState = 'gas';
            water.style.display = 'none';
            removeThreads();
            particles.forEach(p => {
                p.element.style.transform = 'none';
                p.element.style.backgroundColor = 'green';
            });
            if (!animationFrameId) {
                animate();
            }
        });

        createParticles();
        arrangeParticles();
        drawThreads();
        particles.forEach(p => p.element.style.backgroundColor = 'brown');
        water.style.display = 'none';
        animate();
    </script>
</body>
</html>